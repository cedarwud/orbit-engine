# Stage 4 éˆè·¯å¯è¡Œæ€§è©•ä¼°é…ç½®
# ç¬¦åˆè¨ˆåŠƒ A + è¨ˆåŠƒ B å­¸è¡“æ¨™æº–è¦æ±‚

# å­¸è¡“æ¨™æº–æ¨¡å¼ (è¨ˆåŠƒ B)
# é å…ˆåŸ·è¡Œï¼Œç²¾åº¦å„ªå…ˆï¼Œä¸è€ƒæ…®é€Ÿåº¦
use_iau_standards: true  # ä½¿ç”¨ Skyfield IAU æ¨™æº–è¨ˆç®—å™¨ (ç ”ç©¶ç´šç²¾åº¦)
validate_epochs: true     # å•Ÿç”¨ Epoch é©—è­‰ (å­¸è¡“åˆè¦æ¨™æº–ï¼ŒStage 3 ç¾å·²å‚³é epoch_datetime)

# éšæ®µ 4.2 æ™‚ç©ºéŒ¯ç½®æ± è¦åŠƒå„ªåŒ– (NEW)
enable_pool_optimization: true  # å•Ÿç”¨æ™‚ç©ºéŒ¯ç½®æ± è¦åŠƒå„ªåŒ–

# æ˜Ÿåº§ç‰¹å®šé–€æª» (è¨ˆåŠƒ A)
# è¨»: è·é›¢é™åˆ¶å·²ç§»é™¤ï¼Œåƒ…ä½¿ç”¨ä»°è§’é–€æª»é€²è¡Œå¹¾ä½•ç¯©é¸
# åŸå› : ä»°è§’é–€æª»å·²æä¾›è¶³å¤ çš„å¹¾ä½•ç´„æŸï¼ˆStarlink 5Â° â†’ <2000km, OneWeb 10Â° â†’ <1200kmï¼‰
constellation_thresholds:
  starlink:
    elevation_deg: 5.0      # Starlink æœ€å°ä»°è§’
    reason: "Starlink å®˜æ–¹è¦æ ¼"
  oneweb:
    elevation_deg: 10.0     # OneWeb æœ€å°ä»°è§’
    reason: "OneWeb å®˜æ–¹è¦æ ¼"
  default:
    elevation_deg: 10.0     # å…¶ä»–æ˜Ÿåº§é è¨­å€¼

# å¯è¦‹æ€§è¨ˆç®—æ–¹æ³•
visibility:
  method: "skyfield_iau"    # skyfield_iau (IAU æ¨™æº–) æˆ– manual_geometric (å¿«é€Ÿ)
  coordinate_system: "WGS84 Ellipsoid"
  precision_level: "Research Grade"
  nutation_model: "IAU 2000A/2006"
  polar_motion_correction: true
  atmospheric_refraction: true  # Skyfield è‡ªå‹•è™•ç†

# NTPU åœ°é¢ç«™åº§æ¨™
ground_station:
  name: "National Taipei University of Technology"
  latitude_deg: 24.9441
  longitude_deg: 121.3714
  altitude_m: 200.0

# Epoch é©—è­‰è¨­ç½® (è¨ˆåŠƒ B)
epoch_validation:
  enabled: true
  min_diversity_ratio: 0.5       # è¦æ±‚è‡³å°‘ 50% epoch å¤šæ¨£æ€§
  min_diversity_count: 3         # æˆ–è‡³å°‘ 3 å€‹ä¸åŒ epoch
  max_time_diff_days: 7          # æ™‚é–“æˆ³è¨˜èˆ‡ epoch æœ€å¤§å·®è· (å¤©)
  min_distribution_hours: 24     # epoch åˆ†å¸ƒæœ€å°æ™‚é–“è·¨åº¦ (å°æ™‚)
  forbidden_fields:              # ç¦æ­¢çš„çµ±ä¸€æ™‚é–“åŸºæº–å­—æ®µ
    - "calculation_base_time"
    - "primary_epoch_time"
    - "unified_time_base"

# è¼¸å‡ºæ ¼å¼ (è¨ˆåŠƒ A)
output:
  format: "complete_time_series_with_optimization"  # å®Œæ•´æ™‚é–“åºåˆ— + éšæ®µ 4.2 å„ªåŒ–
  version: "plan_a_b_integrated_v1.0"  # è¨ˆåŠƒ A+B æ•´åˆç‰ˆæœ¬ (å«éšæ®µ 4.2)
  include_time_series: true       # åŒ…å«å®Œæ•´æ™‚é–“åºåˆ—
  include_service_window: true    # åŒ…å«æœå‹™çª—å£æ‘˜è¦
  include_is_connectable: true    # åŒ…å«æ¯å€‹æ™‚é–“é»çš„ is_connectable æ¨™è¨˜
  include_link_quality: true      # åŒ…å«éˆè·¯å“è³ªä¼°è¨ˆ
  include_epoch_report: true      # åŒ…å« epoch é©—è­‰å ±å‘Š
  include_optimization_metrics: true  # åŒ…å«éšæ®µ 4.2 å„ªåŒ–æŒ‡æ¨™ (NEW)

# æ—¥èªŒè¨­ç½®
logging:
  level: "INFO"
  enable_progress: true           # é¡¯ç¤ºè™•ç†é€²åº¦
  enable_epoch_validation: true   # é¡¯ç¤º epoch é©—è­‰è©³æƒ…
  enable_iau_standard_info: true  # é¡¯ç¤º IAU æ¨™æº–ä¿¡æ¯

# æ€§èƒ½è¨­ç½®
performance:
  # é å…ˆåŸ·è¡Œæ¨¡å¼ï¼Œä¸éœ€è¦å„ªåŒ–é€Ÿåº¦
  batch_size: null                # ç„¡æ‰¹æ¬¡é™åˆ¶
  parallel_processing: true       # ğŸš¨ æ¸¬è©¦: å•Ÿç”¨ä¸¦è¡Œè™•ç†é©—è­‰ç²¾åº¦å½±éŸ¿
  max_workers: null               # null = å‹•æ…‹è¨ˆç®— (èˆ‡ Stage 2/3 ä¸€è‡´)
  memory_limit_mb: null           # ç„¡è¨˜æ†¶é«”é™åˆ¶

  # å‹•æ…‹ CPU å·¥ä½œå™¨ç­–ç•¥ï¼ˆèˆ‡ Stage 2 ä¸€è‡´ï¼‰
  dynamic_worker_strategy:
    cpu_usage_threshold_high: 30        # CPU < 30%: ä½¿ç”¨ 95% æ ¸å¿ƒï¼ˆç©æ¥µä¸¦è¡Œï¼‰
    cpu_usage_threshold_medium: 50      # CPU 30-50%: ä½¿ç”¨ 75% æ ¸å¿ƒ
    # CPU > 50%: ä½¿ç”¨ 50% æ ¸å¿ƒï¼ˆä¿å®ˆç­–ç•¥ï¼‰

# æ™‚é–“é–“éš”è¨­ç½® (Grade A å­¸è¡“æ¨™æº–è¦æ±‚)
# å­¸è¡“ä¾æ“š: Vallado 2013 Section 8.6 "SGP4 Propagation Time Step Recommendations"
# - å»ºè­° SGP4 å‚³æ’­é–“éš” < 1 åˆ†é˜ä»¥ç¶­æŒç²¾åº¦
# - 30ç§’é–“éš”å°æ‡‰ LEO è¡›æ˜Ÿ ~225km è»Œé“ç§»å‹•ï¼Œè¶³å¤ æ•æ‰å¯è¦‹æ€§è®ŠåŒ–
time_interval_seconds: 30  # å¿…é ˆæ˜ç¢ºæä¾› (ç¦æ­¢é è¨­å€¼)

# éšæ®µ 4.2 æ± å„ªåŒ–ç›®æ¨™é…ç½® (Grade A+ å­¸è¡“æ¨™æº–)
# SOURCE: 3GPP TR 38.821 (2021) Section 6.2 - NTN ç³»çµ±æœå‹™å“è³ªè¦æ±‚
pool_optimization_targets:
  starlink:
    expected_visible_satellites: [10, 15]  # é æœŸå¯è¦‹è¡›æ˜Ÿæ•¸ç¯„åœ [min, max]
    min_pool_size: 10              # æœ€å°æ± å¤§å°ï¼ˆèˆ‡ expected_visible_satellites[0] ä¸€è‡´ï¼‰
    max_pool_size: 15              # æœ€å¤§æ± å¤§å°ï¼ˆèˆ‡ expected_visible_satellites[1] ä¸€è‡´ï¼‰
    target_coverage_rate: 0.95
    # SOURCE: ITU-T E.800 (2008) - ç ”ç©¶åŸå‹ç³»çµ±å¯æ¥å—é–€æª»
    # NOTE: å•†ç”¨ç³»çµ±é€šå¸¸è¦æ±‚ >99% (3GPP TS 22.261 availability requirements)
  oneweb:
    expected_visible_satellites: [3, 6]    # é æœŸå¯è¦‹è¡›æ˜Ÿæ•¸ç¯„åœ [min, max]
    min_pool_size: 3               # æœ€å°æ± å¤§å°ï¼ˆèˆ‡ expected_visible_satellites[0] ä¸€è‡´ï¼‰
    max_pool_size: 6               # æœ€å¤§æ± å¤§å°ï¼ˆèˆ‡ expected_visible_satellites[1] ä¸€è‡´ï¼‰
    target_coverage_rate: 0.95
    # SOURCE: ITU-T E.800 (2008) - ç ”ç©¶åŸå‹ç³»çµ±å¯æ¥å—é–€æª»
    # NOTE: å•†ç”¨ç³»çµ±é€šå¸¸è¦æ±‚ >99% (3GPP TS 22.261 availability requirements)

# å­¸è¡“åˆè¦è²æ˜
academic_compliance:
  iau_standards: true
  vallado_epoch_requirements: true
  kodheli_link_budget: true
  research_grade_precision: true
  peer_review_ready: true

# å¼•ç”¨æ–‡ç»
references:
  - "Vallado, D. A. (2013). Fundamentals of Astrodynamics and Applications (4th ed.). Microcosm Press."
  - "Rhodes, B. (2019). Skyfield: High precision research-grade positions for planets and Earth satellites."
  - "Kodheli, O., et al. (2021). Satellite Communications in the New Space Era. IEEE Communications Surveys & Tutorials."
  - "IAU SOFA (2021). IAU Standards of Fundamental Astronomy."

# ==================== ç’°å¢ƒè®Šæ•¸è¦†å¯«æ”¯æ´ ====================
# æ”¯æ´çš„ç’°å¢ƒè®Šæ•¸ (ç”± BaseConfigManager è‡ªå‹•è™•ç†):
#
# é ‚å±¤éµ (Top-level keys):
# - ORBIT_ENGINE_STAGE4_USE_IAU_STANDARDS: è¦†å¯« use_iau_standards
# - ORBIT_ENGINE_STAGE4_VALIDATE_EPOCHS: è¦†å¯« validate_epochs
# - ORBIT_ENGINE_STAGE4_ENABLE_POOL_OPTIMIZATION: è¦†å¯« enable_pool_optimization
# - ORBIT_ENGINE_STAGE4_TIME_INTERVAL_SECONDS: è¦†å¯« time_interval_seconds
#
# åµŒå¥—éµ (Nested keys) - ä½¿ç”¨ä¸‰é‡ä¸‹åŠƒç·š (___) åˆ†éš”å±¤ç´š:
# - ORBIT_ENGINE_STAGE4_CONSTELLATION_THRESHOLDS___STARLINK___ELEVATION_DEG: è¦†å¯« constellation_thresholds.starlink.elevation_deg
# - ORBIT_ENGINE_STAGE4_CONSTELLATION_THRESHOLDS___ONEWEB___ELEVATION_DEG: è¦†å¯« constellation_thresholds.oneweb.elevation_deg
# - ORBIT_ENGINE_STAGE4_POOL_OPTIMIZATION_TARGETS___STARLINK___MIN_POOL_SIZE: è¦†å¯« pool_optimization_targets.starlink.min_pool_size
# - ORBIT_ENGINE_STAGE4_POOL_OPTIMIZATION_TARGETS___STARLINK___TARGET_COVERAGE_RATE: è¦†å¯« pool_optimization_targets.starlink.target_coverage_rate
# - ORBIT_ENGINE_STAGE4_POOL_OPTIMIZATION_TARGETS___ONEWEB___TARGET_COVERAGE_RATE: è¦†å¯« pool_optimization_targets.oneweb.target_coverage_rate
# - ORBIT_ENGINE_STAGE4_PERFORMANCE___MAX_WORKERS: è¦†å¯« performance.max_workers
# - ORBIT_ENGINE_STAGE4_PERFORMANCE___PARALLEL_PROCESSING: è¦†å¯« performance.parallel_processing
# - ORBIT_ENGINE_STAGE4_EPOCH_VALIDATION___MIN_DIVERSITY_RATIO: è¦†å¯« epoch_validation.min_diversity_ratio
# - ORBIT_ENGINE_STAGE4_LOGGING___LEVEL: è¦†å¯« logging.level
#
# ç¯„ä¾‹:
#   # å–®å€‹è¦†å¯« - æ¸¬è©¦ä¸åŒä»°è§’é–€æª»
#   export ORBIT_ENGINE_STAGE4_CONSTELLATION_THRESHOLDS___STARLINK___ELEVATION_DEG=10.0
#   ./run.sh --stage 4
#
#   # å¤šå€‹è¦†å¯« - æ± å„ªåŒ–å¯¦é©—
#   export ORBIT_ENGINE_STAGE4_POOL_OPTIMIZATION_TARGETS___STARLINK___MIN_POOL_SIZE=12
#   export ORBIT_ENGINE_STAGE4_POOL_OPTIMIZATION_TARGETS___STARLINK___MAX_POOL_SIZE=18
#   export ORBIT_ENGINE_STAGE4_POOL_OPTIMIZATION_TARGETS___STARLINK___TARGET_COVERAGE_RATE=0.98
#   ./run.sh --stage 4
#
#   # èª¿è©¦æ¨¡å¼
#   export ORBIT_ENGINE_STAGE4_LOGGING___LEVEL="DEBUG"
#   export ORBIT_ENGINE_STAGE4_PERFORMANCE___MAX_WORKERS=8
#   ./run.sh --stage 4
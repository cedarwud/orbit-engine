# 🚀 生產環境TDD配置
# 用途: 生產環境專用的TDD整合配置  
# 特點: 重視穩定性和性能，最小化對正常處理的影響

# 基本設定
environment: "production"
debug_mode: false

# TDD整合設定 (生產環境優化)
tdd_integration:
  enabled: true
  execution_mode: "async"              # 異步執行，不影響主處理流程
  failure_handling: "warning"         # 測試失敗不應中斷生產處理
  performance_priority: true          # 優先考慮性能

# 測試類型選擇 (生產環境關鍵)
test_types:
  regression: true                     # 回歸測試: 必須 (檢測異常變化)
  performance: true                    # 性能測試: 必須 (監控系統健康)
  integration: false                   # 整合測試: 跳過 (避免額外開銷)
  compliance: true                     # 合規測試: 必須 (確保標準符合)

# 階段特定設定 (生產環境嚴格)
stages:
  stage1:
    tests: ["regression", "compliance"]
    timeout: 30                        # 適中的超時時間
    async_execution: true              # 異步執行
    critical_failure_handling: "alert" # 關鍵失敗發送警報
  stage2:
    tests: ["regression", "performance"]
    timeout: 25
    async_execution: true
    critical_failure_handling: "alert"
  stage3:
    tests: ["regression", "performance"]
    timeout: 30
    async_execution: true
    critical_failure_handling: "alert"
  stage4:
    tests: ["regression"]
    timeout: 20
    async_execution: true  
    critical_failure_handling: "log"
  stage5:
    tests: ["regression", "performance"]
    timeout: 35
    async_execution: true
    critical_failure_handling: "alert"
  stage6:
    tests: ["regression", "performance", "compliance"]
    timeout: 45
    async_execution: true
    critical_failure_handling: "alert"

# 性能設定 (生產環境嚴格)
performance:
  thresholds:
    processing_time_multiplier: 1.2    # 只允許20%的性能回歸
    memory_usage_multiplier: 1.1      # 只允許10%的記憶體增長
  monitoring:
    enabled: true                      # 必須啟用性能監控
    alerting: true                     # 必須啟用警報
    baseline_tracking: true           # 追蹤性能基準
  
# 警報系統 (生產環境關鍵)
alerting:
  channels:
    email: true                        # 郵件警報
    webhook: true                      # Webhook通知
    sms: false                         # 簡訊警報 (可選)
  
  triggers:
    test_failure_rate_threshold: 0.1   # 測試失敗率閾值 (10%)
    performance_regression_threshold: 0.2 # 性能回歸閾值 (20%)
    continuous_failures: 3            # 連續失敗次數觸發警報
  
  escalation:
    immediate: ["regression_failure", "compliance_violation"]
    delayed: ["performance_regression"]
    daily_summary: ["test_statistics"]

# 日誌設定 (生產環境精簡)
logging:
  level: "WARN"                        # 只記錄警告和錯誤
  console_output: false               # 關閉控制台輸出
  file_output: true                   # 文件輸出
  detailed_test_results: false       # 簡化測試結果記錄
  timestamp_format: "iso"
  include_stack_traces: false        # 不包含堆疊追蹤 (節省空間)
  
# 生產穩定性設定
stability:
  graceful_degradation: true         # 優雅降級
  circuit_breaker:
    enabled: true                    # 熔斷機制
    failure_threshold: 5             # 失敗閾值
    recovery_timeout: 300            # 恢復超時 (秒)
  
  resource_protection:
    max_concurrent_tests: 2          # 最大並發測試數量
    cpu_usage_limit: 50              # CPU使用限制 (%)
    memory_usage_limit: 1024         # 記憶體使用限制 (MB)

# 數據保留策略
data_retention:
  test_results_days: 30              # 測試結果保留30天
  performance_history_days: 90       # 性能歷史保留90天
  error_logs_days: 7                # 錯誤日誌保留7天
  cleanup_schedule: "daily_2am"      # 清理計劃 (每日凌晨2點)

# 安全設定
security:
  sanitize_logs: true                # 清理敏感日誌信息
  encrypted_communication: true      # 加密通信 (如適用)
  access_control: true              # 訪問控制
  audit_trail: true                 # 審計追蹤

# 高可用性設定
high_availability:
  health_checks: true               # 健康檢查
  failover_mechanism: true         # 故障轉移機制
  redundancy: true                 # 冗餘設計
  disaster_recovery: true          # 災難恢復

# 生產監控指標
monitoring_metrics:
  system_health:
    - "test_execution_success_rate"
    - "average_test_execution_time"
    - "system_resource_usage"
    - "error_rate_trending"
  
  business_metrics:  
    - "processing_pipeline_success_rate"
    - "data_quality_score"
    - "compliance_adherence_rate"
    - "performance_baseline_deviation"

# 維護窗口
maintenance_windows:
  daily_maintenance: "02:00-03:00"   # 每日維護時間
  weekly_deep_clean: "sunday_01:00"  # 週末深度清理
  monthly_optimization: "first_sunday_00:00" # 月度優化

# 合規和審計
compliance:
  audit_logging: true               # 審計日誌
  data_governance: true            # 數據治理
  regulatory_reporting: true        # 法規報告
  documentation_updates: "quarterly" # 文檔更新頻率
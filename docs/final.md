# LEO衛星時空錯置動態池規劃與換手優化研究

## 核心目標

### 🎯 基礎衛星池規劃需求

#### **研究基礎設定**
1. **地理定位**: NTPU 座標 24°56'39"N 121°22'17"E
2. **數據來源**: @data/tle_data/ 歷史TLE數據 (非即時追蹤)
3. **分析方法**: 固定時間點的完整軌道週期分析 (離線計算)

#### **動態衛星池核心概念** 🔄
**定義**: 通過數百顆衛星的時空錯置軌道運行，確保NTPU上空任意時刻都維持指定數量衛星可見的動態覆蓋系統。

**🚨 關鍵區別：「候選衛星總數」vs「任意時刻可見數」**:

#### **視覺化對比：數字含義澄清**

| 階段 | 數字 | ❌ 常見誤解 | ✅ 正確含義 |
|------|------|------------|------------|
| **Stage 4.1 輸出** | ~2,000 顆 | 「同時可見 2000 顆」 | 整個軌道週期內「曾經可見」的候選總數 |
| **Stage 4.2 輸出** | ~500 顆 Starlink | 「只剩 500 顆可用」 | 優化後的候選池，通過動態輪替維持覆蓋 |
| **瞬時可見數** | 10-15 顆 | 「固定的 10-15 顆衛星」 | 任意時刻從 500 候選池中動態輪替的可見數 |

#### **動態池運作原理**

```
時間軸示意（Starlink 為例）:

t=0分  → 可見：衛星 A1, A2, B1, B2, C1, C2, D1, D2, E1, E2, F1  (11顆)
          候選池其餘 489 顆：不可見（在地平線下或距離過遠）

t=5分  → 可見：衛星 A2, B1, B2, C1, C2, D1, D2, E1, E2, F1, F2  (11顆)
          A1 離開，F2 進入（動態輪替）

t=10分 → 可見：衛星 B1, B2, C1, C2, D1, D2, E1, E2, F1, F2, G1, G2  (12顆)
          A2 離開，G1, G2 進入

... 以此類推，整個軌道週期內 500 顆候選協同輪替，維持 10-15 顆可見
```

#### **錯誤理解 vs 正確理解**

```
❌ 錯誤理解：
"有 1845 顆 Starlink 候選衛星通過篩選"
→ 誤以為這就達成了「10-15顆可見」的目標
→ 誤以為候選數量 = 可見數量

✅ 正確理解：
"整個軌道週期內，有 ~2000 顆衛星曾經經過 NTPU 上空"
→ Stage 4.2 從中優化出 ~500 顆候選池
→ 這 500 顆通過時空錯置動態輪替
→ 任意時刻只有 10-15 顆同時可見
→ 需要逐時間點驗證：for each minute: count_visible() in [10,15]
```

**關鍵特徵**:
- ❌ **非靜態篩選**: 不是從星座中選出固定的少數衛星
- ❌ **非候選總數**: 候選衛星總數 ≠ 任意時刻可見數
- ❌ **非即時系統**: 不需要毫秒級實時追蹤
- ✅ **動態輪替**: 數百顆候選衛星協同輪替，維持穩定池狀態
- ✅ **逐時驗證**: 必須驗證每個時間點的實際可見衛星數
- ✅ **歷史分析**: 基於TLE歷史數據的週期性分析

#### **星座特定軌道週期** ⚠️ **重要**
**必須分別計算各星座的完整軌道週期，不可統一處理**:

**Starlink 星座 (LEO 低軌)**:
- 軌道高度: ~550km
- 軌道週期: ~90-95分鐘
- 計算範圍: 完整90-95分鐘週期
- 參與衛星: ~200-500顆候選 (可能經過NTPU的衛星)

**OneWeb 星座 (LEO 高軌)**:
- 軌道高度: ~1200km
- 軌道週期: ~109-115分鐘 (比Starlink長約20分鐘)
- 計算範圍: 完整109-115分鐘週期
- 參與衛星: ~50-100顆候選 (極軌道覆蓋範圍大)

#### **衛星池動態維持目標**
**時空錯置池規劃**:
- **Starlink**: 任意時刻保持 10-15顆衛星可見 (5°仰角門檻)
- **OneWeb**: 任意時刻保持 3-6顆衛星可見 (10°仰角門檻)
- **覆蓋要求**: 各自軌道週期內95%+時間滿足池狀態
- **實現機制**: 通過時空錯置確保衛星連續輪替補充

#### **時空錯置原理**
**空間錯置**: 多軌道面衛星在不同空間方向接近NTPU
```
軌道面A: 衛星從西方→東方經過NTPU
軌道面B: 衛星從北方→南方經過NTPU
軌道面C: 衛星從東北→西南經過NTPU
→ 確保全方向覆蓋，無空間死角
```

**時間錯置**: 同軌道面內衛星群的時間差安排
```
Starlink軌道面X:
- 第1批衛星: t=0分經過NTPU
- 第2批衛星: t=15分經過NTPU
- 第3批衛星: t=30分經過NTPU
OneWeb軌道面Y:
- 第1批衛星: t=0分經過NTPU
- 第2批衛星: t=18分經過NTPU (週期較長)
→ 確保時間連續性，無服務空窗
```

### 🛰️ 3GPP NTN換手事件支援需求 (基於TS 38.331標準)
7. **A4事件數據支援**: 鄰近衛星變得優於門檻值 (Neighbour becomes better than threshold)
   - 觸發條件: Mn + Ofn + Ocn – Hys > Thresh (進入條件)
   - 標準依據: 3GPP TS 38.331 v18.5.1 Section 5.5.4.5
   - 用途: 識別潛在換手候選衛星，當鄰近衛星信號品質超過配置門檻
   - 測量: RSRP (dBm), RSRQ/RS-SINR (dB)

8. **A5事件數據支援**: 服務衛星劣於門檻1且鄰近衛星優於門檻2
   - 觸發條件: (Mp + Hys < Thresh1) AND (Mn + Ofn + Ocn – Hys > Thresh2)
   - 標準依據: 3GPP TS 38.331 v18.5.1 Section 5.5.4.6  
   - 用途: 雙門檻換手決策，同時監控服務衛星劣化和鄰近衛星改善
   - 測量: Mp/Mn為RSRP (dBm)或RSRQ/RS-SINR (dB)

9. **D2事件數據支援**: UE與服務衛星距離超過門檻1且與候選衛星距離低於門檻2
   - 觸發條件: (Ml1 – Hys > Thresh1) AND (Ml2 + Hys < Thresh2)
   - 標準依據: 3GPP TS 38.331 v18.5.1 Section 5.5.4.15a
   - 用途: 基於衛星移動軌跡的距離換手，適用於LEO高速移動場景
   - 測量: 距離測量 (米)，基於衛星星歷和移動參考位置

### 🤖 強化學習換手優化需求
10. **訓練數據生成**:
    - 狀態空間: 衛星位置、信號強度、仰角、距離等多維狀態
    - 動作空間: 換手決策(保持/切換至候選衛星1/2/3...)
    - 獎勵函數: 基於QoS、中斷時間、信號品質的複合獎勵
    - 經驗回放: 大量真實換手場景存儲供算法學習

11. **多算法支援**:
    - DQN (Deep Q-Network): 離散動作空間的換手決策
    - A3C (Asynchronous Actor-Critic): 並行學習多種換手策略  
    - PPO (Proximal Policy Optimization): 穩定的策略梯度優化
    - SAC (Soft Actor-Critic): 連續控制的換手參數調優

12. **實時決策支援**:
    - 毫秒級響應: 支援真實時間的換手決策推理
    - 多候選評估: 同時評估3-5個換手候選的優劣
    - 自適應門檻: 根據環境動態調整RSRP/距離門檻

## 🎯 預期成果

### 研究環境完整性
- ✅ 連續不間斷的衛星覆蓋環境 (95%+ 覆蓋率)
- ✅ 豐富的3GPP標準換手事件場景 (50+ 不同場景)
- ✅ 多樣化的強化學習訓練樣本
- ✅ 真實軌道動力學基礎的學術研究數據

### 技術指標達成
- 🛰️ **Starlink時空錯置池**: 10-15顆連續可見 (基於90-95分鐘軌道週期)
- 🛰️ **OneWeb時空錯置池**: 3-6顆連續可見 (基於109-115分鐘軌道週期)
- ⏱️ **軌道週期完整覆蓋**: 各星座週期內95%+時間無服務中斷空窗
- 📊 **衛星池計算規模** ⚠️ (估算值，待實測):
  - **階段性篩選流程**:
    - Stage 3: 9,040 顆全衛星 WGS84 轉換
    - Stage 4.1: ~2,000 顆曾經可見候選（可見性篩選）
    - Stage 4.2: ~500 顆 Starlink + ~100 顆 OneWeb（池優化）⚠️ 待實現
  - **最終計算規模**:
    - Starlink: ~500顆候選 × 95時間點 ≈ 47,500計算點
    - OneWeb: ~100顆候選 × 115時間點 ≈ 11,500計算點
    - 總計算量: ~59,000計算點 (一次性離線計算)
- 🔄 **換手事件頻率**: 每個軌道週期生成50+換手場景
- 🤖 **RL訓練數據**: 基於真實池狀態變化的豐富訓練樣本

⚠️ **估算說明**:
- 上述數字 (~2000, ~500, ~100) 為基於研究需求的理論估算
- Stage 4.2 池優化規劃當前為文檔規劃階段，代碼待實現
- 實際數字將在運行 Stage 1-4 後根據真實數據調整

### 計算與分析方法
#### **歷史數據離線分析** (非即時系統)
```
數據流程:
@data/tle_data/ → 選定時間點 → 各星座獨立軌道週期計算 → 池狀態分析 → 3GPP事件檢測 → RL訓練數據

計算特點:
✅ 一次性計算: 不需要持續運行
✅ 週期性分析: 避免重複計算
✅ 星座分離: Starlink和OneWeb獨立分析
✅ 標準驗證: 95%覆蓋率要求驗證
```

#### **池狀態驗證標準**
```python
# Starlink 池驗證 (90-95分鐘週期)
for time_point in range(95):  # 95分鐘
    visible_starlink = count_visible_satellites(
        constellation="starlink",
        elevation_threshold=5.0,
        time=time_point
    )
    assert 10 <= visible_starlink <= 15

# OneWeb 池驗證 (109-115分鐘週期)
for time_point in range(115):  # 115分鐘
    visible_oneweb = count_visible_satellites(
        constellation="oneweb",
        elevation_threshold=10.0,
        time=time_point
    )
    assert 3 <= visible_oneweb <= 6
```
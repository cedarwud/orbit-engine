# ğŸ›°ï¸ Stage 2: è»Œé“ç‹€æ…‹å‚³æ’­å±¤ - å®Œæ•´è¦æ ¼æ–‡æª”

**æœ€å¾Œæ›´æ–°**: 2025-10-01 (æ•ˆèƒ½æ•¸æ“šæ›´æ–°)
**é‡æ§‹ç‹€æ…‹**: âœ… å·²å®Œæˆ Skyfield ç›´æ¥å¯¦ç¾
**å­¸è¡“åˆè¦**: Grade A æ¨™æº–ï¼ŒNASA JPL ç²¾åº¦
**æ¥å£æ¨™æº–**: 100% BaseStageProcessor åˆè¦
**æ•ˆèƒ½æå‡**: ğŸš€ 56% è™•ç†é€Ÿåº¦æå‡ (vs é‡æ§‹å‰)

## ğŸ“– æ¦‚è¿°èˆ‡ç›®æ¨™

**æ ¸å¿ƒè·è²¬**: ç›´æ¥ä½¿ç”¨ Skyfield é€²è¡Œ SGP4/SDP4 è»Œé“å‚³æ’­
**è¼¸å…¥**: Stage 1 çš„ ProcessingResult (åŒ…å«æ¯é¡†è¡›æ˜Ÿçš„ epoch_datetime)
**è¼¸å‡º**: TEME åº§æ¨™ç³»çµ±ä¸­çš„ä½ç½®/é€Ÿåº¦æ™‚é–“åºåˆ—
**è™•ç†æ•ˆèƒ½**: âœ… **152.9ç§’** (9,041é¡†è¡›æ˜Ÿï¼Œå‹•æ…‹è»Œé“é€±æœŸ) - ç”Ÿç”¢ç’°å¢ƒå®Œæ•´è™•ç†
**è™•ç†é€Ÿåº¦**: âœ… **59.1 é¡†è¡›æ˜Ÿ/ç§’** - NASA JPL æ¨™æº–ç²¾åº¦
**è»Œé“é»ç”Ÿæˆ**: âœ… **1,726,294å€‹** TEME åº§æ¨™é» (652 MB è¼¸å‡º)
**æˆåŠŸç‡**: âœ… **100%** - é›¶å¤±æ•—ç‡

### ğŸ¯ Stage 2 æ ¸å¿ƒåƒ¹å€¼
- **è»Œé“ç‹€æ…‹è¨ˆç®—**: åŸºæ–¼ Stage 1 epoch_datetime çš„ç²¾ç¢º SGP4/SDP4 å‚³æ’­
- **æ™‚é–“åºåˆ—ç”Ÿæˆ**: ç‚ºç›®æ¨™æ™‚é–“çª—å£ç”Ÿæˆå®Œæ•´çš„ä½ç½®/é€Ÿåº¦åºåˆ—
- **TEME åº§æ¨™è¼¸å‡º**: æä¾›æ¨™æº– True Equator Mean Equinox åº§æ¨™çµ¦ Stage 3
- **é›¶é‡è¤‡è§£æ**: å®Œå…¨ä½¿ç”¨ Stage 1 æä¾›çš„ epoch_datetimeï¼Œä¸é‡æ–°è§£æ TLE

## ğŸš¨ é‡è¦æ¦‚å¿µä¿®æ­£

### âŒ **ä¿®æ­£å‰çš„éŒ¯èª¤æ¦‚å¿µ**
```
Stage 2: å¯è¦‹æ€§ç¯©é¸
- é‡æ–°è§£æ TLE epoch æ™‚é–“
- ä»°è§’é–€æª»ç¯©é¸ (10Â°)
- è·é›¢ç¯„åœæª¢æŸ¥ (200-2000km)
- è¼¸å‡ºã€Œå¯è¦‹è¡›æ˜Ÿã€åˆ—è¡¨
```

### âœ… **ç°¡åŒ–é‡æ§‹å¾Œçš„å¯¦ç¾**
```
Stage 2: è»Œé“ç‹€æ…‹å‚³æ’­ (Skyfield ç›´æ¥å¯¦ç¾)
- ç›´æ¥ä½¿ç”¨ Skyfield NASA JPL æ¨™æº–åº«
- ç§»é™¤ SGP4OrbitalEngine ä¸­é–“åŒ…è£å±¤
- é›¶æ ¼å¼è½‰æ›ï¼ŒåŸç”Ÿ TEME åº§æ¨™è¼¸å‡º
- è¡›æ˜Ÿå¿«å–æ©Ÿåˆ¶ï¼Œé¿å…é‡è¤‡å‰µå»º
- 59.1 é¡†è¡›æ˜Ÿ/ç§’è™•ç†é€Ÿåº¦ (56% æå‡)
```

**å­¸è¡“ä¾æ“š**:
> *"Orbital propagation should be separated from visibility analysis. SGP4/SDP4 algorithms generate orbital states in TEME coordinates, while visibility requires coordinate transformation and geometric calculations."*
> â€” Vallado, D. A. (2013). Fundamentals of Astrodynamics and Applications

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### âœ… ç°¡åŒ–é‡æ§‹å¾Œçš„ç›´æ¥æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Stage 2: è»Œé“ç‹€æ…‹å‚³æ’­å±¤ (Skyfield ç›´æ¥å¯¦ç¾)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            SGP4Calculator (ç°¡åŒ–ç‰ˆ)              â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚  ğŸš€ ç›´æ¥ä½¿ç”¨ Skyfield NASA JPL æ¨™æº–            â”‚   â”‚
â”‚  â”‚  âŒ ç§»é™¤ SGP4OrbitalEngine ä¸­é–“å±¤              â”‚   â”‚
â”‚  â”‚  ğŸ“¦ å…§å»ºè¡›æ˜Ÿå¿«å– (é¿å…é‡è¤‡å‰µå»º)                 â”‚   â”‚
â”‚  â”‚  ğŸ“Š é›¶æ ¼å¼è½‰æ›ï¼ŒåŸç”Ÿ TEME è¼¸å‡º                 â”‚   â”‚
â”‚  â”‚  âš¡ 59.1 é¡†/ç§’è™•ç†é€Ÿåº¦ (56% æå‡)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                            â”‚
â”‚                            â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Stage2OrbitalPropagationProcessor          â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚  âœ… ä½¿ç”¨ Stage 1 epoch_datetime (v3.0åˆè¦)     â”‚   â”‚
â”‚  â”‚  ğŸ›°ï¸ æ˜Ÿåº§åˆ†é›¢è¨ˆç®— (Starlink/OneWeb)            â”‚   â”‚
â”‚  â”‚  â±ï¸ æ™‚é–“åºåˆ—ç”Ÿæˆ (å‹•æ…‹è»Œé“é€±æœŸ)                â”‚   â”‚
â”‚  â”‚  ğŸ“ TEME åº§æ¨™æ¨™æº–è¼¸å‡º                          â”‚   â”‚
â”‚  â”‚  ğŸ”¬ 5é …å°ˆç”¨é©—è­‰æª¢æŸ¥                            â”‚   â”‚
â”‚  â”‚  ğŸ“ˆ 100% æˆåŠŸç‡ (9,041é¡†è¡›æ˜Ÿå¯¦æ¸¬)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ **é‡æ§‹æ”¹é€²å°æ¯”**

| é …ç›® | é‡æ§‹å‰ (è¤‡é›œç‰ˆ) | é‡æ§‹å¾Œ (ç°¡åŒ–ç‰ˆ) | æå‡å¹…åº¦ |
|------|----------------|-----------------|----------|
| **èª¿ç”¨å±¤æ•¸** | 3å±¤åŒ…è£ | 1å±¤ç›´æ¥ | **67% ç°¡åŒ–** |
| **è™•ç†æ™‚é–“** | ~239ç§’ | **152.9ç§’** | **ğŸš€ 56% æå‡** |
| **è™•ç†é€Ÿåº¦** | ~38é¡†/ç§’ | **59.1é¡†/ç§’** | **ğŸš€ 56% æå‡** |
| **æˆåŠŸç‡** | æœªçŸ¥ | **100.0%** | **å®Œç¾ç©©å®š** |
| **ç¶­è­·è² æ“”** | è¤‡é›œåŒ…è£å±¤ | å–®ä¸€Skyfield | **å¤§å¹…ç°¡åŒ–** |
| **å­¸è¡“å¯ä¿¡** | è‡ªå»ºåŒ…è£ | NASA JPLæ¨™æº– | **æ¬Šå¨ä¿è­‰** |

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½èˆ‡è·è²¬

### âœ… **Stage 2 å°ˆå±¬è·è²¬**

#### 1. **æ™‚é–“åºåˆ—è¦åŠƒèˆ‡æ˜Ÿåº§åˆ†é›¢è¨ˆç®—**
- **ç›®æ¨™æ™‚é–“çª—å£**: 2å°æ™‚è»Œé“å‚³æ’­çª—å£ (åŸºæ–¼æ˜Ÿåº§è»Œé“é€±æœŸå„ªåŒ–)
- **æ™‚é–“æ­¥é•·**: 30ç§’é–“éš” (é…ç½®å„ªåŒ–å¾Œ)
- **æ˜Ÿåº§ç‰¹å®šè»Œé“é€±æœŸ** âš ï¸ **é‡è¦**ï¼š
  - **Starlink**: ~90-95åˆ†é˜è»Œé“é€±æœŸ (LEO ä½è»Œ ~550km)
  - **OneWeb**: ~109-115åˆ†é˜è»Œé“é€±æœŸ (LEO é«˜è»Œ ~1200km)
- **æ™‚é–“ç¯„åœ**: å‹•æ…‹è¨ˆç®—
  - Starlink: 191å€‹æ™‚é–“é» (95åˆ†é˜ Ã· 30ç§’)
  - OneWeb: 224å€‹æ™‚é–“é» (112åˆ†é˜ Ã· 30ç§’)
- **æ™‚é–“ä¾†æº**: 100% ä½¿ç”¨ Stage 1 æä¾›çš„ epoch_datetime

#### 2. **SGP4/SDP4 è»Œé“å‚³æ’­**
- **å°ˆæ¥­åº«ä½¿ç”¨**: ä½¿ç”¨ skyfield æˆ– pyephem ç­‰å­¸è¡“ç´šåº«
- **ç²¾ç¢ºè¨ˆç®—**: åŸºæ–¼æ¯é¡†è¡›æ˜Ÿçš„çœŸå¯¦ epoch æ™‚é–“
- **è»Œé“å…ƒç´ **: ä½¿ç”¨ Stage 1 è§£æçš„å®Œæ•´ TLE æ•¸æ“š
- **èª¤å·®æ§åˆ¶**: ç¬¦åˆ SGP4 å®˜æ–¹ç²¾åº¦æ¨™æº–

#### 3. **TEME åº§æ¨™ç³»çµ±è¼¸å‡º**
- **æ¨™æº–åº§æ¨™**: True Equator Mean Equinox åº§æ¨™
- **ä½ç½®å‘é‡**: (x, y, z) åœ¨ TEME åƒè€ƒç³»
- **é€Ÿåº¦å‘é‡**: (vx, vy, vz) åœ¨ TEME åƒè€ƒç³»
- **æ™‚é–“æˆ³è¨˜**: æ¯å€‹ç‹€æ…‹é»çš„ç²¾ç¢ºæ™‚é–“

#### 4. **æ•¸æ“šçµæ§‹æ¨™æº–åŒ–**
- **æ™‚é–“åºåˆ—æ ¼å¼**: æ¨™æº–åŒ–è»Œé“ç‹€æ…‹é™£åˆ—
- **å…ƒæ•¸æ“šå®Œæ•´**: åŒ…å«å‚³æ’­åƒæ•¸å’Œèª¤å·®ä¼°è¨ˆ
- **è¨˜æ†¶é«”å„ªåŒ–**: é«˜æ•ˆçš„æ•¸æ“šçµæ§‹è¨­è¨ˆ

### âŒ **æ˜ç¢ºæ’é™¤è·è²¬** (ç§»è‡³å¾ŒçºŒéšæ®µ)
- âŒ **åº§æ¨™è½‰æ›**: TEMEâ†’ITRFâ†’WGS84 è½‰æ› (ç§»è‡³ Stage 3)
- âŒ **å¯è¦‹æ€§åˆ†æ**: ä»°è§’ã€æ–¹ä½è§’è¨ˆç®— (ç§»è‡³ Stage 4)
- âŒ **è·é›¢ç¯©é¸**: åœ°é¢ç«™è·é›¢ç´„æŸ (ç§»è‡³ Stage 4)
- âŒ **æ˜Ÿåº§æ„ŸçŸ¥**: ç‰¹å®šé–€æª»å€¼è™•ç† (ç§»è‡³ Stage 4)
- âŒ **TLE é‡æ–°è§£æ**: ç¦æ­¢é‡æ–°è§£æä»»ä½• TLE è³‡æ–™

## ğŸ” æ™‚é–“åŸºæº–ä½¿ç”¨è¦ç¯„

### ğŸš¨ **CRITICAL: ç¦æ­¢ TLE é‡æ–°è§£æ**

**âŒ çµ•å°ç¦æ­¢çš„åšæ³•**:
```python
# ç¦æ­¢ï¼ä¸å¾—é‡æ–°è§£æ TLE epoch
epoch_year = int(tle_line1[18:20])
epoch_day = float(tle_line1[20:32])
epoch_time = datetime(full_year, 1, 1, tzinfo=timezone.utc) + timedelta(days=epoch_day - 1)
```

**âœ… æ­£ç¢ºçš„åšæ³•**:
```python
# æ­£ç¢ºï¼ä½¿ç”¨ Stage 1 æä¾›çš„ epoch_datetime
satellite_data = stage1_result.data['satellites'][i]
epoch_datetime = datetime.fromisoformat(satellite_data['epoch_datetime'])

# ä½¿ç”¨ epoch_datetime é€²è¡Œ SGP4 è¨ˆç®—
satrec = Satrec.twoline2rv(
    satellite_data['tle_line1'],
    satellite_data['tle_line2']
)
```

### æ™‚é–“åŸºæº–ç¹¼æ‰¿æ©Ÿåˆ¶
```python
# Stage 1 â†’ Stage 2 æ•¸æ“šæµ
stage1_output = {
    'satellites': [
        {
            'name': 'STARLINK-1234',
            'epoch_datetime': '2025-09-27T07:30:24.572437+00:00',  # ä½¿ç”¨æ­¤æ™‚é–“
            'tle_line1': '...',
            'tle_line2': '...'
        }
    ]
}

# Stage 2 è™•ç†æµç¨‹
for satellite in stage1_output['satellites']:
    epoch_dt = datetime.fromisoformat(satellite['epoch_datetime'])
    # åŸºæ–¼æ­¤ epoch æ™‚é–“é€²è¡Œ SGP4 æ™‚é–“åºåˆ—è¨ˆç®—
```

## ğŸ”„ æ•¸æ“šæµï¼šä¸Šæ¸¸ä¾è³´èˆ‡ä¸‹æ¸¸ä½¿ç”¨

### ğŸ“¥ ä¸Šæ¸¸ä¾è³´ (Stage 1 â†’ Stage 2)

#### å¾ Stage 1 æ¥æ”¶çš„æ•¸æ“š
**å¿…è¦è¼¸å…¥æ•¸æ“š**:
- âœ… `satellites[]` - å®Œæ•´çš„è¡›æ˜Ÿåˆ—è¡¨
  - `satellite_id` - è¡›æ˜Ÿå”¯ä¸€æ¨™è­˜ç¬¦
  - `name` - è¡›æ˜Ÿåç¨± (ç”¨æ–¼æ˜Ÿåº§è­˜åˆ¥)
  - `norad_id` - NORAD ç›®éŒ„ç·¨è™Ÿ
  - `epoch_datetime` - **æ ¸å¿ƒæ™‚é–“åŸºæº–** (ISO 8601 æ ¼å¼)
  - `tle_line1` - TLE ç¬¬ä¸€è¡Œ (69å­—ç¬¦æ¨™æº–æ ¼å¼)
  - `tle_line2` - TLE ç¬¬äºŒè¡Œ (69å­—ç¬¦æ¨™æº–æ ¼å¼)
  - `constellation` - æ˜Ÿåº§æ­¸å±¬ (starlink/oneweb)

- âœ… `metadata.constellation_configs` - æ˜Ÿåº§é…ç½®å…ƒæ•¸æ“š
  - `orbital_period_range_minutes` - è»Œé“é€±æœŸç¯„åœ (ç”¨æ–¼æ™‚é–“çª—å£è¦åŠƒ)
  - `typical_altitude_km` - å…¸å‹è»Œé“é«˜åº¦ (åƒè€ƒå€¼)

**æ•¸æ“šè¨ªå•ç¯„ä¾‹**:
```python
from stages.stage1_orbital_calculation.stage1_main_processor import Stage1TLEDataProcessor

# åŸ·è¡Œ Stage 1
stage1_processor = Stage1TLEDataProcessor(config)
stage1_result = stage1_processor.execute()

# Stage 2 è¨ªå•å¿…è¦æ•¸æ“š
satellites = stage1_result.data['satellites']
constellation_configs = stage1_result.data['metadata']['constellation_configs']

for satellite in satellites:
    # ç²å–æ™‚é–“åŸºæº– (é›¶é‡è¤‡è§£æ)
    epoch_dt = datetime.fromisoformat(satellite['epoch_datetime'])

    # ç²å– TLE æ•¸æ“š
    tle_line1 = satellite['tle_line1']
    tle_line2 = satellite['tle_line2']

    # ç²å–æ˜Ÿåº§é…ç½®
    constellation = satellite['constellation']
    orbital_period = constellation_configs[constellation]['orbital_period_range_minutes']

    # é€²è¡Œ SGP4 è»Œé“å‚³æ’­...
```

#### Stage 1 æ•¸æ“šä¾è³´é—œä¿‚
- **ğŸš¨ CRITICAL**: `epoch_datetime` æ˜¯å”¯ä¸€çš„æ™‚é–“åŸºæº–ä¾†æº
  - **ç¦æ­¢**: é‡æ–°è§£æ TLE ä¸­çš„ epoch æ¬„ä½
  - **å¿…é ˆ**: 100% ä½¿ç”¨ Stage 1 æä¾›çš„ ISO 8601 æ ¼å¼æ™‚é–“
- **æ˜Ÿåº§åˆ†é›¢**: `constellation` æ¬„ä½ç”¨æ–¼å‹•æ…‹è»Œé“é€±æœŸè¨ˆç®—
  - Starlink: 90-95åˆ†é˜æ™‚é–“çª—å£
  - OneWeb: 109-115åˆ†é˜æ™‚é–“çª—å£
- **å­¸è¡“åˆè¦**: Stage 1 å·²å®Œæˆ TLE æ ¼å¼é©—è­‰å’Œæ™‚é–“è§£æ

### ğŸ“¤ ä¸‹æ¸¸ä½¿ç”¨ (Stage 2 â†’ Stage 3/4)

#### Stage 3: åº§æ¨™è½‰æ›å±¤ä½¿ç”¨çš„æ•¸æ“š
**ä½¿ç”¨çš„è¼¸å‡º**:
- âœ… `orbital_states[satellite_id].time_series[]` - TEME åº§æ¨™æ™‚é–“åºåˆ—
  - `timestamp` - æ™‚é–“æˆ³è¨˜ (UTC)
  - `position_teme` - TEME åº§æ¨™ç³»çµ±ä½ç½®å‘é‡ [x, y, z] (km)
  - `velocity_teme` - TEME åº§æ¨™ç³»çµ±é€Ÿåº¦å‘é‡ [vx, vy, vz] (km/s)

- âœ… `orbital_states[satellite_id].propagation_metadata` - è»Œé“å‚³æ’­å…ƒæ•¸æ“š
  - `epoch_datetime` - åŸå§‹ epoch æ™‚é–“ (å‚³éè‡ª Stage 1)
  - `orbital_period_minutes` - å¯¦éš›è»Œé“é€±æœŸ
  - `time_step_seconds` - æ™‚é–“æ­¥é•· (30ç§’)

**Stage 3 æ•¸æ“šæµç¯„ä¾‹**:
```python
# Stage 3 è™•ç†å™¨æ¥æ”¶ Stage 2 è¼¸å‡º
stage3_processor = Stage3CoordinateTransformProcessor(config)
stage3_result = stage3_processor.execute(stage2_result.data)

# Stage 3 è¨ªå• TEME åº§æ¨™
for satellite_id, orbital_data in stage2_result.data['orbital_states'].items():
    for time_point in orbital_data['time_series']:
        # TEME åº§æ¨™ (Stage 2 è¼¸å‡º)
        position_teme = time_point['position_teme']  # [x, y, z] km
        velocity_teme = time_point['velocity_teme']  # [vx, vy, vz] km/s
        timestamp = time_point['timestamp']

        # é€²è¡Œ TEME â†’ ITRF â†’ WGS84 è½‰æ›...
        wgs84_coords = skyfield_transform(position_teme, velocity_teme, timestamp)
```

#### Stage 4: éˆè·¯å¯è¡Œæ€§å±¤é–“æ¥ä½¿ç”¨çš„æ•¸æ“š
**é–“æ¥ä¾è³´** (é€é Stage 3):
- Stage 2 æä¾›çš„è»Œé“é€±æœŸè³‡è¨Š â†’ Stage 3 â†’ Stage 4
- Stage 2 çš„æ™‚é–“æ­¥é•·ä¿è­‰ â†’ å½±éŸ¿ Stage 4 å¯è¦‹æ€§åˆ†æçš„æ™‚é–“è§£æåº¦
- æ˜Ÿåº§åˆ†é›¢è¨ˆç®—çµæœ â†’ ç¢ºä¿ Stage 4 èƒ½æ­£ç¢ºæ‡‰ç”¨æ˜Ÿåº§ç‰¹å®šé–€æª»

**é—œéµå‚³ééˆ**:
```
Stage 1 epoch_datetime
  â†’ Stage 2 SGP4 å‚³æ’­ (TEME åº§æ¨™)
    â†’ Stage 3 åº§æ¨™è½‰æ› (WGS84)
      â†’ Stage 4 å¯è¦‹æ€§åˆ†æ (ä»°è§’/è·é›¢)
```

### ğŸ”„ æ•¸æ“šå®Œæ•´æ€§ä¿è­‰

âœ… **æ™‚é–“åŸºæº–ç¹¼æ‰¿**: Stage 1 epoch â†’ Stage 2 æ™‚é–“åºåˆ— â†’ Stage 3/4 åˆ†æ
âœ… **åº§æ¨™ç³»çµ±æ¨™æº–**: TEME æ¨™æº–è¼¸å‡ºï¼Œç¬¦åˆ Skyfield/NASA JPL è¦ç¯„
âœ… **æ˜Ÿåº§æ„ŸçŸ¥å‚³é**: æ˜Ÿåº§é…ç½®å¾ Stage 1 â†’ Stage 2 â†’ å¾ŒçºŒéšæ®µ
âœ… **å­¸è¡“åˆè¦**: é›¶é‡è¤‡è§£æï¼Œé›¶è‡ªè£½ç®—æ³•ï¼Œ100% å°ˆæ¥­åº«å¯¦ç¾

## ğŸ“Š æ¨™æº–åŒ–è¼¸å‡ºæ ¼å¼

### ProcessingResult çµæ§‹
```python
ProcessingResult(
    status=ProcessingStatus.SUCCESS,
    data={
        'stage': 2,
        'stage_name': 'orbital_state_propagation',
        'orbital_states': {
            'satellite_id_1': {
                'time_series': [
                    {
                        'timestamp': '2025-09-27T08:00:00.000000+00:00',
                        'position_teme': [x, y, z],  # TEME åº§æ¨™ (km)
                        'velocity_teme': [vx, vy, vz]  # TEME é€Ÿåº¦ (km/s)
                    },
                    # ... æ›´å¤šæ™‚é–“é»
                ],
                'propagation_metadata': {
                    'epoch_datetime': '2025-09-27T07:30:24.572437+00:00',
                    'orbital_period_minutes': 93.2,
                    'time_step_seconds': 30,
                    'total_time_points': 224
                }
            }
            # ... æ›´å¤šè¡›æ˜Ÿ
        },
        'metadata': {
            # æ™‚é–“åºåˆ—åƒæ•¸
            'time_window': {
                'start_time': '2025-09-27T08:00:00.000000+00:00',
                'end_time': '2025-09-28T08:00:00.000000+00:00',
                'time_step_seconds': 30,
                'timezone': 'UTC'
            },

            # è»Œé“å‚³æ’­è¨­å®š
            'propagation_config': {
                'sgp4_library': 'skyfield',
                'coordinate_system': 'TEME',
                'gravitational_model': 'SGP4',
                'epoch_source': 'stage1_parsed'
            },

            # è™•ç†çµ±è¨ˆ
            'total_satellites': 9041,
            'processing_duration_seconds': 239.2,
            'time_series_generated': True,

            # åˆè¦æ¨™è¨˜
            'tle_reparsing_forbidden': True,
            'stage1_epoch_compliance': True,
            'academic_standard': 'Grade_A'
        }
    },
    metadata={...},
    errors=[],
    warnings=[],
    metrics=ProcessingMetrics(...)
)
```

### è»Œé“ç‹€æ…‹æ•¸æ“šæ ¼å¼
```python
orbital_state = {
    'timestamp': '2025-09-27T08:00:00.000000+00:00',
    'position_teme': [x, y, z],      # TEME åº§æ¨™ (km)
    'velocity_teme': [vx, vy, vz],   # TEME é€Ÿåº¦ (km/s)
    'satellite_id': 'STARLINK-1234',
    'propagation_error': 0.001,      # km (ä¼°è¨ˆèª¤å·®)
}
```

## âš¡ æ€§èƒ½æŒ‡æ¨™ (ç°¡åŒ–é‡æ§‹å¾Œå¯¦æ¸¬)

### ğŸš€ **å¯¦éš›æ€§èƒ½æŒ‡æ¨™ - 2025-10-01 æœ€æ–°æ¸¬è©¦çµæœ**
- **è™•ç†æ™‚é–“**: âœ… **152.9ç§’** (9,041é¡†è¡›æ˜Ÿ) - ç”Ÿç”¢ç’°å¢ƒå®Œæ•´è™•ç†
- **è™•ç†é€Ÿåº¦**: âœ… **59.1é¡†è¡›æ˜Ÿ/ç§’** - NASA JPL æ¨™æº–ç²¾åº¦
- **è»Œé“é»é€Ÿåº¦**: âœ… **11,287é»/ç§’** - é«˜é€Ÿæ‰¹é‡è¨ˆç®—
- **æˆåŠŸç‡**: âœ… **100.0%** - é›¶å¤±æ•—ç‡ (9,041/9,041)
- **è»Œé“é»ç¸½æ•¸**: âœ… **1,726,294å€‹** - å®Œæ•´å‹•æ…‹è»Œé“é€±æœŸæ™‚é–“åºåˆ—
- **å¹³å‡é»æ•¸/è¡›æ˜Ÿ**: âœ… **190.9é»** - å‹•æ…‹è»Œé“é€±æœŸè¨ˆç®— (1.0xé€±æœŸè¦†è“‹)
- **æ™‚é–“æ­¥é•·**: 30ç§’é–“éš” (å¯é…ç½®)
- **è¼¸å‡ºæ–‡ä»¶å¤§å°**: 652 MB (å®Œæ•´ TEME åº§æ¨™æ•¸æ“š)

### ğŸ“Š **æ˜Ÿåº§åˆ†é›¢è™•ç†æ•ˆèƒ½**
- **Starlink**: 8,390é¡†è¡›æ˜Ÿï¼Œ~191è»Œé“é»/è¡›æ˜Ÿ (~95åˆ†é˜ï¼Œ1.03xè»Œé“é€±æœŸ)
- **OneWeb**: 651é¡†è¡›æ˜Ÿï¼Œ~218è»Œé“é»/è¡›æ˜Ÿ (~108.5åˆ†é˜ï¼Œ0.97xè»Œé“é€±æœŸ)
- **å¼•æ“é¡å‹**: `Skyfield_Direct` (NASA JPL æ¨™æº–)
- **è¨˜æ†¶é«”ä½¿ç”¨**: ~1,485 MB (å®Œæ•´æ™‚é–“åºåˆ—æ•¸æ“š)
- **ç²¾åº¦æ¨™æº–**: SGP4 å®˜æ–¹ç²¾åº¦è¦ç¯„
- **æ™‚é–“çª—å£**: å‹•æ…‹è»Œé“é€±æœŸ (Starlink: 90-95min, OneWeb: 109-115min, è¦†è“‹ ~1.0x è»Œé“é€±æœŸ)

### èˆ‡ Stage 3 é›†æˆ
- **æ•¸æ“šæ ¼å¼**: æ¨™æº–åŒ– TEME åº§æ¨™
- **åº§æ¨™ç³»çµ±**: True Equator Mean Equinox
- **å‚³éæ–¹å¼**: ProcessingResult.data çµæ§‹
- **å…¼å®¹æ€§**: ç‚º Stage 3 åº§æ¨™è½‰æ›æº–å‚™

## ğŸ—ï¸ é©—è­‰æ¶æ§‹è¨­è¨ˆ

### å…©å±¤é©—è­‰æ©Ÿåˆ¶

æœ¬ç³»çµ±æ¡ç”¨**å…©å±¤é©—è­‰æ¶æ§‹**ï¼Œç¢ºä¿æ•¸æ“šå“è³ªçš„åŒæ™‚é¿å…é‡è¤‡é‚è¼¯ï¼š

#### **Layer 1: è™•ç†å™¨å…§éƒ¨é©—è­‰** (ç”Ÿç”¢é©—è­‰)
- **è² è²¬æ¨¡çµ„**: `Stage2OrbitalPropagationProcessor.run_validation_checks()`
- **åŸ·è¡Œæ™‚æ©Ÿ**: è™•ç†å™¨åŸ·è¡Œå®Œæˆå¾Œç«‹å³åŸ·è¡Œ
- **é©—è­‰å…§å®¹**: è©³ç´°çš„ 5 é …å°ˆç”¨é©—è­‰æª¢æŸ¥
- **è¼¸å‡ºçµæœ**:
  ```json
  {
    "checks_performed": 5,
    "checks_passed": 5,
    "check_details": {
      "epoch_datetime_validation": {"passed": true, "details": {...}},
      "sgp4_propagation_accuracy": {"passed": true, "details": {...}},
      "time_series_completeness": {"passed": true, "details": {...}},
      "teme_coordinate_validation": {"passed": true, "details": {...}},
      "memory_performance_check": {"passed": true, "details": {...}}
    }
  }
  ```
- **ä¿å­˜ä½ç½®**: `data/validation_snapshots/stage2_validation.json`

#### **Layer 2: è…³æœ¬å“è³ªæª¢æŸ¥** (å¿«ç…§é©—è­‰)
- **è² è²¬æ¨¡çµ„**: `check_validation_snapshot_quality()` in `run_six_stages_with_validation.py`
- **åŸ·è¡Œæ™‚æ©Ÿ**: è®€å–é©—è­‰å¿«ç…§æ–‡ä»¶å¾Œ
- **è¨­è¨ˆåŸå‰‡**:
  - âœ… **ä¿¡ä»» Layer 1 çš„è©³ç´°é©—è­‰çµæœ**
  - âœ… æª¢æŸ¥ Layer 1 æ˜¯å¦åŸ·è¡Œå®Œæ•´ (`checks_performed == 5`)
  - âœ… æª¢æŸ¥ Layer 1 æ˜¯å¦é€šé (`checks_passed >= 4`)
  - âœ… é¡å¤–çš„æ¶æ§‹åˆè¦æ€§æª¢æŸ¥ï¼ˆv3.0 æ¨™è¨˜ã€æ˜Ÿåº§åˆ†é›¢ã€ç¦æ­¢è·è²¬ç­‰ï¼‰
- **ä¸æ‡‰é‡è¤‡**: Layer 1 çš„è©³ç´°æª¢æŸ¥é‚è¼¯

### é©—è­‰æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 2 åŸ·è¡Œ                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. processor.execute(stage1_data) â†’ ProcessingResult       â”‚
â”‚     â†“                                                       â”‚
â”‚  2. processor.run_validation_checks() (Layer 1)             â”‚
â”‚     â†’ åŸ·è¡Œ 5 é …è©³ç´°é©—è­‰                                      â”‚
â”‚     â†’ ç”Ÿæˆ validation_checks å°è±¡                           â”‚
â”‚     â†“                                                       â”‚
â”‚  3. processor.save_validation_snapshot()                    â”‚
â”‚     â†’ ä¿å­˜åˆ° stage2_validation.json                         â”‚
â”‚     â†“                                                       â”‚
â”‚  4. check_validation_snapshot_quality() (Layer 2)           â”‚
â”‚     â†’ è®€å–é©—è­‰å¿«ç…§                                           â”‚
â”‚     â†’ æª¢æŸ¥ checks_performed/checks_passed                   â”‚
â”‚     â†’ æ¶æ§‹åˆè¦æ€§æª¢æŸ¥ (v3.0, ç¦æ­¢è·è²¬)                        â”‚
â”‚     â†“                                                       â”‚
â”‚  5. é©—è­‰é€šé â†’ é€²å…¥ Stage 3                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‚ºä»€éº¼ä¸åœ¨ Layer 2 é‡è¤‡æª¢æŸ¥ï¼Ÿ

**è¨­è¨ˆå“²å­¸**ï¼š
- **å–®ä¸€è·è²¬**: Layer 1 è² è²¬è©³ç´°é©—è­‰ï¼ŒLayer 2 è² è²¬åˆç†æ€§æª¢æŸ¥
- **é¿å…é‡è¤‡**: è©³ç´°é©—è­‰é‚è¼¯å·²åœ¨è™•ç†å™¨å…§éƒ¨å¯¦ç¾ï¼Œç„¡éœ€åœ¨è…³æœ¬ä¸­é‡è¤‡
- **ä¿¡ä»»æ©Ÿåˆ¶**: Layer 2 ä¿¡ä»» Layer 1 çš„å°ˆæ¥­é©—è­‰çµæœ
- **æ•ˆç‡è€ƒé‡**: é¿å…é‡è¤‡è®€å–å¤§é‡æ•¸æ“šé€²è¡ŒäºŒæ¬¡é©—è­‰

**Layer 2 çš„çœŸæ­£åƒ¹å€¼**ï¼š
- ç¢ºä¿ Layer 1 ç¢ºå¯¦åŸ·è¡Œäº†é©—è­‰ï¼ˆé˜²æ­¢å¿˜è¨˜èª¿ç”¨ï¼‰
- æ¶æ§‹å±¤é¢çš„é˜²ç¦¦æ€§æª¢æŸ¥ï¼ˆå¦‚ç¦æ­¢ TLE é‡æ–°è§£æã€ç¦æ­¢åº§æ¨™è½‰æ›ï¼‰
- æ•¸æ“šæ‘˜è¦çš„åˆç†æ€§æª¢æŸ¥ï¼ˆå¦‚è¡›æ˜Ÿæ•¸é‡ã€è»Œé“é»æ•¸ã€æ˜Ÿåº§åˆ†é›¢ï¼‰

## ğŸ”¬ é©—è­‰æ¡†æ¶

### 5é …å°ˆç”¨é©—è­‰æª¢æŸ¥ (Layer 1 è™•ç†å™¨å…§éƒ¨)
1. **epoch_datetime_validation** - æ™‚é–“åŸºæº–é©—è­‰
   - ç¢ºèªä½¿ç”¨ Stage 1 æä¾›çš„ epoch_datetime
   - ç¦æ­¢ TLE é‡æ–°è§£ææª¢æŸ¥
   - æ™‚é–“æ ¼å¼ä¸€è‡´æ€§é©—è­‰

2. **sgp4_propagation_accuracy** - è»Œé“å‚³æ’­ç²¾åº¦
   - SGP4 è¨ˆç®—çµæœåˆç†æ€§æª¢æŸ¥
   - è»Œé“é€±æœŸé©—è­‰ (LEO: 90-120åˆ†é˜)
   - é€Ÿåº¦é‡ç´šæª¢æŸ¥ (LEO: ~7.5 km/s)

3. **time_series_completeness** - æ™‚é–“åºåˆ—å®Œæ•´æ€§
   - æ™‚é–“æ­¥é•·ä¸€è‡´æ€§æª¢æŸ¥
   - æ•¸æ“šé»é€£çºŒæ€§é©—è­‰
   - æ™‚é–“çª—å£è¦†è“‹å®Œæ•´æ€§

4. **teme_coordinate_validation** - TEME åº§æ¨™é©—è­‰
   - åº§æ¨™ç³»çµ±æ­£ç¢ºæ€§æª¢æŸ¥
   - ä½ç½®å‘é‡é‡ç´šé©—è­‰ (LEO: 6400-8000 km)
   - é€Ÿåº¦å‘é‡æ–¹å‘æ€§æª¢æŸ¥

5. **memory_performance_check** - è¨˜æ†¶é«”æ€§èƒ½æª¢æŸ¥
   - è¨˜æ†¶é«”ä½¿ç”¨é‡ç›£æ§
   - æ•¸æ“šçµæ§‹æ•ˆç‡é©—è­‰
   - è™•ç†æ™‚é–“æ€§èƒ½åŸºæº–

## ğŸš€ ä½¿ç”¨æ–¹å¼èˆ‡é…ç½®

### æ¨™æº–èª¿ç”¨æ–¹å¼
```python
from stages.stage2_orbital_computing.stage2_orbital_computing_processor import Stage2OrbitalPropagationProcessor

# æ¥æ”¶ Stage 1 çµæœ
stage1_result = stage1_processor.execute()

# å‰µå»º Stage 2 è™•ç†å™¨
processor = Stage2OrbitalPropagationProcessor(config)

# åŸ·è¡Œè»Œé“å‚³æ’­
result = processor.execute(stage1_result.data)  # ä½¿ç”¨ Stage 1 æ•¸æ“š

# é©—è­‰æª¢æŸ¥
validation = processor.run_validation_checks(result.data)

# Stage 3 æ•¸æ“šæº–å‚™
stage3_input = result.data  # TEME åº§æ¨™æ•¸æ“š
```

### é…ç½®é¸é …
```python
config = {
    'time_series_config': {
        'start_time': '2025-09-27T08:00:00+08:00',  # å°ç£æ™‚é–“
        'duration_hours': 24,
        'time_step_seconds': 30,
        'timezone': 'Asia/Taipei'
    },
    'propagation_config': {
        'sgp4_library': 'skyfield',  # æˆ– 'pyephem'
        'coordinate_system': 'TEME',
        'error_tolerance': 0.001,  # km
        'max_propagation_days': 7
    },
    'performance_config': {
        'parallel_processing': True,
        'max_workers': 8,
        'memory_limit_gb': 2
    }
}
```

## ğŸ“‹ éƒ¨ç½²èˆ‡é©—è­‰

### éƒ¨ç½²æª¢é©—æ¨™æº–
**æˆåŠŸæŒ‡æ¨™**:
- [x] ä½¿ç”¨ Stage 1 epoch_datetime (é›¶ TLE é‡æ–°è§£æ)
- [x] TEME åº§æ¨™æ•¸æ“šç”Ÿæˆæ­£å¸¸ (1,726,294å€‹è»Œé“é»)
- [x] æ™‚é–“åºåˆ—å®Œæ•´æ€§æª¢æŸ¥é€šé
- [x] SGP4 è¨ˆç®—ç²¾åº¦ç¬¦åˆæ¨™æº–
- [x] è™•ç†æ™‚é–“ < 300ç§’ (å¯¦éš› 152.9ç§’)
- [x] 9,041é¡†è¡›æ˜Ÿè»Œé“ç‹€æ…‹ç”Ÿæˆ
- [x] 100% æˆåŠŸç‡ (é›¶å¤±æ•—)
- [x] 5/5 å°ˆç”¨é©—è­‰æª¢æŸ¥é€šé
- [x] è¼¸å‡ºæ–‡ä»¶æ­£å¸¸ä¿å­˜ (652 MB)

### æ¸¬è©¦å‘½ä»¤
```bash
# è¨­ç½®æ¸¬è©¦æ¨¡å¼
export ORBIT_ENGINE_TEST_MODE=1

# å®Œæ•´ Stage 2 æ¸¬è©¦
python scripts/run_six_stages_with_validation.py --stage 2

# æª¢æŸ¥è»Œé“ç‹€æ…‹è¼¸å‡º
cat data/validation_snapshots/stage2_validation.json | jq '.data_summary'

# é©—è­‰ TEME åº§æ¨™
cat data/validation_snapshots/stage2_validation.json | jq '.metadata.coordinate_system'

# æª¢æŸ¥è¼¸å‡ºæ–‡ä»¶
ls -lh data/outputs/stage2/
```

**å¯¦éš›æ¸¬è©¦çµæœ (2025-10-01)**:
```
âœ… Stage 2 åŸ·è¡ŒæˆåŠŸ
   åŸ·è¡Œæ™‚é–“: 152.9 ç§’
   è™•ç†è¡›æ˜Ÿ: 9,041 é¡†
   æˆåŠŸç‡: 100.0%
   è»Œé“é»æ•¸: 1,726,294 å€‹
   è¼¸å‡ºæ–‡ä»¶: orbital_propagation_output_20251001_065111.json (652 MB)
   é©—è­‰ç‹€æ…‹: 5/5 é …æª¢æŸ¥é€šé
```

## ğŸ¯ å­¸è¡“æ¨™æº–åˆè¦

### Grade A å¼·åˆ¶è¦æ±‚
- **âœ… å°ˆæ¥­åº«**: ä½¿ç”¨ skyfield æˆ– pyephem ç­‰å­¸è¡“ç´š SGP4 å¯¦ç¾
- **âœ… æ™‚é–“åŸºæº–**: 100% ä½¿ç”¨ Stage 1 epoch_datetimeï¼Œé›¶é‡æ–°è§£æ
- **âœ… åº§æ¨™æ¨™æº–**: åš´æ ¼ TEME åº§æ¨™ç³»çµ±è¼¸å‡º
- **âœ… è»Œé“ç²¾åº¦**: ç¬¦åˆ SGP4 å®˜æ–¹ç²¾åº¦è¦ç¯„
- **âœ… æ•¸æ“šå®Œæ•´**: å®Œæ•´çš„ä½ç½®/é€Ÿåº¦æ™‚é–“åºåˆ—

### é›¶å®¹å¿é …ç›®
- **âŒ TLE é‡æ–°è§£æ**: çµ•å°ç¦æ­¢é‡æ–°è§£æä»»ä½• TLE è³‡æ–™
- **âŒ ç°¡åŒ–è»Œé“**: ç¦æ­¢ä½¿ç”¨ Keplerian æˆ–ç°¡åŒ–è»Œé“æ¨¡å‹
- **âŒ è‡ªè£½ SGP4**: ç¦æ­¢è‡ªè¡Œå¯¦ç¾ SGP4 ç®—æ³•
- **âŒ åº§æ¨™æ··åˆ**: ç¦æ­¢åœ¨æ­¤éšæ®µé€²è¡Œåº§æ¨™è½‰æ›
- **âŒ å¯è¦‹æ€§è¨ˆç®—**: ç¦æ­¢åœ¨æ­¤éšæ®µé€²è¡Œå¯è¦‹æ€§åˆ†æ

---

**æ–‡æª”ç‰ˆæœ¬**: v3.0 (é‡æ§‹ç‰ˆ)
**æ¦‚å¿µç‹€æ…‹**: âœ… è»Œé“ç‹€æ…‹å‚³æ’­ (å·²ä¿®æ­£)
**å­¸è¡“åˆè¦**: âœ… Grade A æ¨™æº–
**ç¶­è­·è² è²¬**: Orbit Engine Team